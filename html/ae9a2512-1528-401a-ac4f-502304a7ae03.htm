<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>分页查询</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="ae9a2512-1528-401a-ac4f-502304a7ae03" /><meta name="Description" content="PagingInfo 是一种分页查询的实现模式：在查询数据时，可以指定查询的具体页码 PageIndex、一页所含数据行数 PageSize，就可以把该页的数据显示在界面上了。但是，在进行分页时，往往要在界面中显示一个分页脚，用于显示当前页号、所有页数。所以在进行查询的同时，还需要对结果集中所有数据的总行数进行统计，并把这个总行数与查询出的实体列表数据一同返回。所以，PagingInfo 添加了额外的两个属性，IsNeedCount、TotalCount，当 IsNeedCount 被设置为真时，框架在数据" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c8e6cd25-c674-4cd1-9880-816d11f58eb8.htm" title="领域实体框架" tocid="c8e6cd25-c674-4cd1-9880-816d11f58eb8">领域实体框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="6b377084-3fc9-4bf6-94d7-bc9a42ed82a7.htm" title="实体仓库" tocid="6b377084-3fc9-4bf6-94d7-bc9a42ed82a7">实体仓库</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="59c80aec-c910-4880-b165-c3495ed5eb3e.htm" title="编写查询" tocid="59c80aec-c910-4880-b165-c3495ed5eb3e">编写查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c7c6d07b-bb41-4590-a2a6-8b0b49ce1c0b.htm" title="Linq 查询" tocid="c7c6d07b-bb41-4590-a2a6-8b0b49ce1c0b">Linq 查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="6d65448c-b51b-4c9b-9500-f6b7a48b1188.htm" title="SqlTree 查询" tocid="6d65448c-b51b-4c9b-9500-f6b7a48b1188">SqlTree 查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="02f40bcc-1ff3-4abc-b4a9-2dea57d516ce.htm" title="通用查询条件(CommonQueryCriteria)" tocid="02f40bcc-1ff3-4abc-b4a9-2dea57d516ce">通用查询条件(CommonQueryCriteria)</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c2eced2c-e434-4d53-a06d-fbc518fbddf5.htm" title="Sql 查询" tocid="c2eced2c-e434-4d53-a06d-fbc518fbddf5">Sql 查询</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="ae9a2512-1528-401a-ac4f-502304a7ae03.htm" title="分页查询" tocid="ae9a2512-1528-401a-ac4f-502304a7ae03">分页查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="3e3ee502-ecbb-417d-8fbf-fa24ec21e2bc.htm" title="贪婪加载" tocid="3e3ee502-ecbb-417d-8fbf-fa24ec21e2bc">贪婪加载</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="56b9e7bc-2656-4bde-95dd-69e71aeafc6a.htm" title="数据行数查询" tocid="56b9e7bc-2656-4bde-95dd-69e71aeafc6a">数据行数查询</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="55180b16-9fda-42a1-8c4f-27d037aeae76.htm" title="表格查询" tocid="55180b16-9fda-42a1-8c4f-27d037aeae76">表格查询</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>分页查询</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>本页包含以下内容：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#PagingInfo">PagingInfo 分页信息类型</a></li><li class="outlineSectionEntry"><a href="#pagingQuery">分页查询</a></li></ul></div><div class="collapsibleAreaRegion" id="PagingInfo"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />PagingInfo 分页信息类型</span></div><div id="ID1RBSection" class="collapsibleSection"><p>PagingInfo 是一种分页查询的实现模式：在查询数据时，可以指定查询的具体页码 PageIndex、一页所含数据行数 PageSize，就可以把该页的数据显示在界面上了。但是，在进行分页时，往往要在界面中显示一个分页脚，用于显示当前页号、所有页数。所以在进行查询的同时，还需要对结果集中所有数据的总行数进行统计，并把这个总行数与查询出的实体列表数据一同返回。所以，PagingInfo 添加了额外的两个属性，IsNeedCount、TotalCount，当 IsNeedCount 被设置为真时，框架在数据层进行查询时，会把统计出来的总行数赋值给 TotalCount。这样，上层（界面层）在调用查询方法完成后，不但获取到了实体的列表，也获取到了总行数。</p><p>PagingInfo 公有接口如下：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAACAAA');return false;" title="复制">复制</a></div></div><div id="ID0EAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">public</span> <span class="highlight-keyword">class</span> PagingInfo
{
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">readonly</span> PagingInfo Empty;

    <span class="highlight-keyword">public</span> PagingInfo(<span class="highlight-keyword">int</span> pageNumber, <span class="highlight-keyword">int</span> pageSize);
    <span class="highlight-keyword">protected</span> PagingInfo(SerializationInfo info, StreamingContext context);
    <span class="highlight-keyword">public</span> PagingInfo(<span class="highlight-keyword">int</span> pageNumber, <span class="highlight-keyword">int</span> pageSize, <span class="highlight-keyword">bool</span> isNeedCount);
    <span class="highlight-keyword">public</span> PagingInfo(<span class="highlight-keyword">int</span> pageNumber, <span class="highlight-keyword">int</span> pageSize, <span class="highlight-keyword">int</span> totalCount);

    <span class="highlight-keyword">public</span> <span class="highlight-keyword">bool</span> HasNextPage { <span class="highlight-keyword">get</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">bool</span> HasPreviousPage { <span class="highlight-keyword">get</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">bool</span> IsNeedCount { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> PageCount { <span class="highlight-keyword">get</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> PageNumber { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> PageSize { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> TotalCount { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }

    <span class="highlight-keyword">public</span> <span class="highlight-keyword">bool</span> IsEmpty();

    <span class="highlight-keyword">public</span> <span class="highlight-keyword">static</span> <span class="highlight-keyword">bool</span> IsNullOrEmpty(PagingInfo pagingInfo);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAACAAA");</script></div><div class="collapsibleAreaRegion" id="pagingQuery"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />分页查询</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
                    Rafy 领域实体框架中的分页查询都是在数据层进行分页。在进行实体查询时，对于所有支持 <span class="code">Rafy.PagingInfo</span> 类型为参数的方法，都是支持分页的方法。例如：
                </p><p>以下代码示例如何使用 PagingInfo 类型：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EABABAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EABABAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EABABAAA');return false;" title="复制">复制</a></div></div><div id="ID0EABABAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">PagingInfo pagingInfo = <span class="highlight-keyword">new</span> PagingInfo(<span class="highlight-number">2</span>, <span class="highlight-number">20</span>, <span class="highlight-keyword">true</span>);<span class="highlight-comment">//第 2 页，一页 20 个，并需要返回总行数。</span>

<span class="highlight-comment">//本行执行实体查询，在数据库中进行分页（Sql 语句分页），返回需要的 20 个实体，</span>
<span class="highlight-comment">//并查询出满足条件的实体个数，给 pagingInfo.TotalCount 赋值。</span>
WarehouseRepository repo = RF.ResolveInstance&lt;WarehouseRepository&gt;();
WarehouseList list = repo.GetAll(pagingInfo);

GridView.DataSource = list;<span class="highlight-comment">//绑定到界面的列表</span>
Pager.PageNumber = pagingInfo.PageNumber;
Pager.PageSize = pagingInfo.PageSize;
Pager.TotalCount = pagingInfo.TotalCount;<span class="highlight-comment">//总行数</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABABAAA");</script><p>
                    关于分页的更多信息，可以参见博文：<a href="http://www.cnblogs.com/zgynhqf/archive/2013/01/23/2873583.html" target="_blank">Rafy ORM 中的分页查询设计</a></p></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>