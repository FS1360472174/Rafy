<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>文件存储插件</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="d862044a-9278-47cc-857e-3ccbdd3d3ed6" /><meta name="Description" content="本文介绍 Rafy.FileStorage 插件的场景、使用方法。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="2a81b03d-24b4-4463-9e57-34cbaa105adf.htm" title="现有插件" tocid="2a81b03d-24b4-4463-9e57-34cbaa105adf">现有插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="f662f88a-8221-49f4-bc38-901134ea893e.htm" title="幽灵插件" tocid="f662f88a-8221-49f4-bc38-901134ea893e">幽灵插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="1ce3c19a-3de6-4956-afd0-a7fc6e577768.htm" title="流水号插件" tocid="1ce3c19a-3de6-4956-afd0-a7fc6e577768">流水号插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="e13240fe-3c80-47e1-9645-f154e8b72a83.htm" title="时间戳插件" tocid="e13240fe-3c80-47e1-9645-f154e8b72a83">时间戳插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="507d98b9-f88c-48bf-a12b-dded5e021340.htm" title="帐户插件" tocid="507d98b9-f88c-48bf-a12b-dded5e021340">帐户插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="c4919121-bad5-4b1d-b3c2-6a889590af53.htm" title="RBAC 插件" tocid="c4919121-bad5-4b1d-b3c2-6a889590af53">RBAC 插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="5554eab4-a79f-473c-ac64-d028e7e39145.htm" title="多国语言插件" tocid="5554eab4-a79f-473c-ac64-d028e7e39145">多国语言插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="064b28a9-25ac-49f1-a964-56bbea3fac89.htm" title="附件插件" tocid="064b28a9-25ac-49f1-a964-56bbea3fac89">附件插件</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="87a44564-2ce0-4065-8174-ce612bc1583b.htm" title="大批量导入实体插件" tocid="87a44564-2ce0-4065-8174-ce612bc1583b">大批量导入实体插件</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="d862044a-9278-47cc-857e-3ccbdd3d3ed6.htm" title="文件存储插件" tocid="d862044a-9278-47cc-857e-3ccbdd3d3ed6">文件存储插件</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>文件存储插件</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>本文介绍 Rafy.FileStorage 插件的场景、使用方法。</p><p>本页包含以下内容：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#senarios">场景</a></li><li class="outlineSectionEntry"><a href="#howto">使用方法</a></li><li class="outlineSectionEntry"><a href="#explain">扩展</a></li></ul></div><div class="collapsibleAreaRegion" id="senarios"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />场景</span></div><div id="ID0RBSection" class="collapsibleSection"><p>在开发各类数据库应用系统时，往往需要存储大量的文件。一般情况下，开发者并不会把文件存储到数据库中，而是把文件存储在本地文件夹、文件服务器、云端，同时，在数据库中存储这个文件相关的信息到一个统一的表中，方便管理与查找。所有使用到文件（如附件）的其它实体，都外键关联这个表来对应相应的文件。</p><p>
                    本插件专用于上述场景。使用本插件后，开发者只需要简单地保存、查询 <span class="code">FileInfo</span> 实体，即可自动完成实体中文件数据的保存。
                </p></div><div class="collapsibleAreaRegion" id="howto"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />使用方法</span></div><div id="ID2RBSection" class="collapsibleSection"><h3 class="procedureSubHeading">添加插件</h3><div class="subSection"><ol><li><p>通过 Nuget Package Manager 搜索并安装 Rafy.FileStorage 插件。</p></li><li><p>在 DomainApp 中添加该插件；同时，设置该插件所对应的数据库配置名：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAAAAABACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAAAAABACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAAAAABACAAA');return false;" title="复制">复制</a></div></div><div id="ID1EAAAAABACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">class</span> JXCApp : DomainApp
{
    <span class="highlight-keyword">protected</span> <span class="highlight-keyword">override</span> <span class="highlight-keyword">void</span> InitEnvironment()
    {
        <span class="highlight-comment">//配置插件所对应的数据库配置名。</span>
        Rafy.FileStorage.FileStoragePlugin.DbSettingName = <span class="highlight-literal">"TestDb"</span>;

        <span class="highlight-comment">//添加流水号插件到 Rafy 应用程序集中。</span>
        RafyEnvironment.DomainPlugins.Add(<span class="highlight-keyword">new</span> Rafy.FileStorage.FileStoragePlugin());

        <span class="highlight-keyword">base</span>.InitEnvironment();
    }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAAAAABACAAA");</script></li></ol></div><h3 class="procedureSubHeading">使用插件</h3><div class="subSection"><ol><li><p>
                                    生成数据库。
                                </p><p>
                                    该插件中自带一个实体：<span class="code">FileInfo</span> ，所以 Rafy 会为其在数据库中添加相应的一张表。
                                </p></li><li><p>
                                    直接使用 FileInfo 对象来保存和读取文件的内容即可。如下：
                                </p><p>保存文件及文件内容：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EACAAAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EACAAAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EACAAAAACAAA');return false;" title="复制">复制</a></div></div><div id="ID1EACAAAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">var</span> repo = RF.ResolveInstance&lt;FileInfoRepository&gt;();
<span class="highlight-keyword">var</span> file = <span class="highlight-keyword">new</span> FileInfo
{
    Name = <span class="highlight-literal">"1.txt"</span>,
    Description = <span class="highlight-literal">"Nothing"</span>,
    Content = Encoding.UTF8.GetBytes(<span class="highlight-literal">"File Content"</span>)
};
repo.Save(file);</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EACAAAAACAAA");</script><p>读取文件及文件内容：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAAAAAAACAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAAAAAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAAAAAAACAAA');return false;" title="复制">复制</a></div></div><div id="ID1EAAAAAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">var</span> repo = RF.ResolveInstance&lt;FileInfoRepository&gt;();
<span class="highlight-keyword">var</span> file = repo.GetById(file.Id);
<span class="highlight-keyword">var</span> content = Encoding.UTF8.GetString(file.Content);<span class="highlight-comment">//Content 属性使用懒加载设计，不到使用时是不会加载到内存中的。</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAAAAAAACAAA");</script></li></ol></div></div><div class="collapsibleAreaRegion" id="explain"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />扩展</span></div><div id="ID3RBSection" class="collapsibleSection"><p>本插件默认使用了 <span class="code">DiskFileContentProvider</span> 提供程序来保存文件的内容（即保存在本地文件夹中）。开发者如果想要更换保存文件的逻辑，请实现 <span class="code">IFileInfoContentProvider</span> 接口，并设置到 <span class="code">FileStoragePlugin.ContentProvider</span> 属性中。</p></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>