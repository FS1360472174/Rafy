<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SQL 语句日志</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="12520633-1fbf-45dc-aca8-c4089b5c90e0" /><meta name="Description" content="使用数据访问接口 IDbAccesser 访问数据库时，系统可以记录所有运行过程中执行的 Sql 语句及相关日志。这对于开发人员做系统调试、性能优化提供了较好的帮助。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c8e6cd25-c674-4cd1-9880-816d11f58eb8.htm" title="领域实体框架" tocid="c8e6cd25-c674-4cd1-9880-816d11f58eb8">领域实体框架</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="0f6e3552-029f-4a32-9655-e4b6fb22edcc.htm" title="对象关系映射" tocid="0f6e3552-029f-4a32-9655-e4b6fb22edcc">对象关系映射</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="eba03db2-2a71-4499-9dcd-99e0c37fe10e.htm" title="配置映射" tocid="eba03db2-2a71-4499-9dcd-99e0c37fe10e">配置映射</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="8b3a3b78-9e6a-4558-938d-7692ae6aaa8f.htm" title="继承映射" tocid="8b3a3b78-9e6a-4558-938d-7692ae6aaa8f">继承映射</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="12520633-1fbf-45dc-aca8-c4089b5c90e0.htm" title="SQL 语句日志" tocid="12520633-1fbf-45dc-aca8-c4089b5c90e0">SQL 语句日志</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="b40cd779-ec8a-469d-82f5-bd99128561c4.htm" title="数据库同步功能" tocid="b40cd779-ec8a-469d-82f5-bd99128561c4">数据库同步功能</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="99366b1b-7583-4c95-9f78-3178b0bd50f9.htm" title="为数据库生成注释" tocid="99366b1b-7583-4c95-9f78-3178b0bd50f9">为数据库生成注释</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="ef53c777-dd02-4a01-98c9-7dcc49489cec.htm" title="多数据库支持" tocid="ef53c777-dd02-4a01-98c9-7dcc49489cec">多数据库支持</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="1d3cd55d-9f80-4a63-812b-fc17851b3ab0.htm" title="多数据源切换" tocid="1d3cd55d-9f80-4a63-812b-fc17851b3ab0">多数据源切换</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>SQL 语句日志</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>
                使用数据访问接口 <span class="code">IDbAccesser</span> 访问数据库时，系统可以记录所有运行过程中执行的 Sql 语句及相关日志。这对于开发人员做系统调试、性能优化提供了较好的帮助。
            </p><p>
                ORM 框架中所有的数据访问，都是直接或间接地通过 <span class="code">IDbAccesser</span> 类型来完成的，所以本机制可以显示框架与数据库的所有交互。
            </p><p>本页包含以下内容：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#how">使用文件记录</a></li><li class="outlineSectionEntry"><a href="#high">高级</a></li></ul></div><div class="collapsibleAreaRegion" id="how"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />使用文件记录</span></div><div id="ID1RBSection" class="collapsibleSection"><p>要打开这个功能，需要到应用程序的配置文件中添加名为 Rafy.FileLogger.SqlTraceFileName 的应用程序配置项，该配置项的值是用于记录日志的文件地址，示例代码如下：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACACAAA');return false;" title="复制">复制</a></div></div><div id="ID0EACACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">configuration</span><span class="highlight-xml-bracket">&gt;</span>
    <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">appSettings</span><span class="highlight-xml-bracket">&gt;</span>
        <span class="highlight-xml-comment">&lt;!--如果是监听应用程序所有的 SQL 语句，请打开以下配置--&gt;</span>
        <span class="highlight-xml-bracket">&lt;</span><span class="highlight-xml-tag">add</span> <span class="highlight-xml-attribute-name">key</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"Rafy.FileLogger.SqlTraceFileName"</span> <span class="highlight-xml-attribute-name">value</span><span class="highlight-xml-attribute-equal">=</span><span class="highlight-xml-attribute-value">"D:\SQLTraceLog.txt"</span><span class="highlight-xml-bracket">/&gt;</span>
    <span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">appSettings</span><span class="highlight-xml-bracket">&gt;</span>
<span class="highlight-xml-bracket">&lt;/</span><span class="highlight-xml-tag">configuration</span><span class="highlight-xml-bracket">&gt;</span></pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACACAAA");</script><p>打开此配置项后，文件即会被自动添加，其中日志的格式如下：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EAAACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EAAACAAA');return false;" title="复制">复制</a></div></div><div id="ID0EAAACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">2013/10/2 16:16:43
Database:  Test_RafyUnitTest
SELECT [Book].[Id],[Book].[Author],[Book].[BookCategoryId],[Book].[BookLocId],[Book].[Code],[Book].[Name],[Book].[Price],[Book].[Publisher]
FROM [Book]
ORDER BY [Book].[Id] ASC


2013/10/2 16:16:43
Database:  Test_RafyUnitTest
INSERT INTO [Users] ([Age],[UserName],[TasksTime],[TestUserExt_UserCode]) VALUES (@p0,@p1,@p2,@p3)
Parameters:10,"QueryExt_User",0,"DefaultUserCode"


2013/10/2 16:16:43
Database:  Test_RafyUnitTest
SELECT @@IDENTITY;


2013/10/2 16:16:43
Database:  Test_RafyUnitTest
SELECT [Users].[Id],[Users].[Age],[Users].[UserName],[Users].[TasksTime],[Users].[TestUserExt_UserCode]
FROM [Users]
WHERE [Users].[Age] = @p0
ORDER BY [Users].[Id] ASC
Parameters:10</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EAAACAAA");</script></div><div class="collapsibleAreaRegion" id="high"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />高级</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
                    如果不想使用文件记录日志，或者想自定义 Sql 日志格式，请使用 <span class="code">Rafy.Logger.SetImplementation</span> 方法替换为自己的日志实体类型。
                </p></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>