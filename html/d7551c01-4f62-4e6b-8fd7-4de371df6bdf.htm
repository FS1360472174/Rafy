<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-zh-CN.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>领域服务</title><meta name="Language" content="zh-cn" /><meta name="Microsoft.Help.Id" content="d7551c01-4f62-4e6b-8fd7-4de371df6bdf" /><meta name="Description" content="Rafy 领域服务是跨组合实体的业务逻辑的封装体。一个领域服务协同一系列领域实体来完成一个独立的业务逻辑。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Rafy User Guide<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy User Guide" tocid="roottoc">Rafy User Guide</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="69b641cf-d1fe-4f06-877f-b479d268a3fc.htm" title="Rafy框架" tocid="69b641cf-d1fe-4f06-877f-b479d268a3fc">Rafy框架</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="c8e6cd25-c674-4cd1-9880-816d11f58eb8.htm" title="领域实体框架" tocid="c8e6cd25-c674-4cd1-9880-816d11f58eb8">领域实体框架</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="793cbe04-7265-4de9-a7d7-fb890aebc525.htm" title="领域逻辑" tocid="793cbe04-7265-4de9-a7d7-fb890aebc525">领域逻辑</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="de820b7a-0bf7-498b-89b6-3f80cf29de40.htm" title="领域控制器" tocid="de820b7a-0bf7-498b-89b6-3f80cf29de40">领域控制器</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="acc34fac-b431-4db9-a86b-83f40c812b97.htm" title="单连接事务" tocid="acc34fac-b431-4db9-a86b-83f40c812b97">单连接事务</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="21a4d8a5-c34d-4725-adfe-ed5f95b22977.htm" title="执行SQL或存储过程" tocid="21a4d8a5-c34d-4725-adfe-ed5f95b22977">执行SQL或存储过程</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="d7551c01-4f62-4e6b-8fd7-4de371df6bdf.htm" title="领域服务" tocid="d7551c01-4f62-4e6b-8fd7-4de371df6bdf">领域服务</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="点击或拖拽改变大小" title="点击或拖拽改变大小" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>领域服务</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>本页包含以下内容：</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#intro">简介</a></li><li class="outlineSectionEntry"><a href="#demo">代码示例</a></li><li class="outlineSectionEntry"><a href="#args">服务的输入与输出</a></li><li class="outlineSectionEntry"><a href="#ext">服务的扩展</a></li><li class="outlineSectionEntry"><a href="#soa">SOA</a></li></ul></div><div class="collapsibleAreaRegion" id="intro"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />简介</span></div><div id="ID0RBSection" class="collapsibleSection"><p>Rafy 领域服务是跨组合实体的业务逻辑的封装体。一个领域服务协同一系列领域实体来完成一个独立的业务逻辑。</p><p>Rafy 领域服务的特点：</p><ul><li><p>领域逻辑封装体</p><p>Rafy 中的服务与经典 DDD 中的领域服务类似，它们都是业务逻辑的封装体、组织体。</p></li><li><p>采用命令模式设计</p><p>与其它的服务框架不同，Rafy 使用了命令模式来设计领域服务，以单独类来封装每个单独的服务。而 WebService/WCF 等服务框架，则是用方法来表达每一个单独的服务。把服务抽象为单独的类的模式，不但可以保证服务与服务间的相互独立，还能更好地使用面向对象的特性来提供服务的可扩展性。</p></li><li><p>较高的可扩展性</p><p>服务的可替换性：通过服务的工厂来创建服务的实例，使得我们对服务的创建过程进行扩展。例如可以使用新的服务来替换旧的服务，而不需要修改旧的服务调用代码。</p></li><li><p>无状态</p><p>领域服务是无状态的。虽然服务类都有属性，但每一次服务的调用都需要构造新的服务对象，而服务对象的属性只是为了传递服务的输入和输出，是临时的状态，当调用完成后，服务对象即被丢弃、回收。</p></li><li><p>支持本地调用，也支持分布式调用</p><p>
                            领域服务也是除了仓库查询以外，提供分布式数据传输的另一机制。服务的调用，支持本地调用，也支持分布式调用。详见：<a href="f55333b8-3524-4a07-99bc-6a1cdb6be6b4.htm">部署</a>。
                        </p></li><li><p>SOA 架构的基础</p><p>在面向服务架构思想的指导下，Rafy 才抽取出领域服务。同时领域服务也是在 Rafy 框架中进行多系统集成的基础组件。</p></li></ul></div><div class="collapsibleAreaRegion" id="demo"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />代码示例</span></div><div id="ID2RBSection" class="collapsibleSection"><p>以下代码声明了一个简单的加法逻辑服务：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EADAEAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EADAEAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EADAEAAA');return false;" title="复制">复制</a></div></div><div id="ID1EADAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">[Serializable, Contract, ContractImpl]
<span class="highlight-keyword">public</span> <span class="highlight-keyword">class</span> AddService : Service
{
    <span class="highlight-comment">//服务的两个输入参数</span>
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> A { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> B { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }

    <span class="highlight-comment">//服务的输出参数</span>
    [ServiceOutput]
    <span class="highlight-keyword">public</span> <span class="highlight-keyword">int</span> Result { <span class="highlight-keyword">get</span>; <span class="highlight-keyword">set</span>; }

    <span class="highlight-keyword">protected</span> <span class="highlight-keyword">override</span> <span class="highlight-keyword">void</span> Execute()
    {
        Result = A + B;
    }
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EADAEAAA");</script><p>要支持远程调用，必须标记服务为可序列化的。</p><p>对服务的调用也很简单，直接通过服务工厂服务一个服务对象，设置输入参数，调用服务，即可获取服务的输出：</p><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID1EAAAEAAA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID1EAAAEAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID1EAAAEAAA');return false;" title="复制">复制</a></div></div><div id="ID1EAAAEAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">AddService svc = ServiceFactory.Create&lt;AddService&gt;();
svc.A = <span class="highlight-number">1</span>;
svc.B = <span class="highlight-number">2</span>;
svc.Invoke();<span class="highlight-comment">//自动分辨为远程调用，还是本地调用。</span>
<span class="highlight-keyword">int</span> result = svc.Result;</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID1EAAAEAAA");</script></div><div class="collapsibleAreaRegion" id="args"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />服务的输入与输出</span></div><div id="ID3RBSection" class="collapsibleSection"><p>以类的形式封装服务后，同样，每个服务需要声明它的输出和输出，形同方法的参数与返回值。领域服务的输入和输出都以服务类的属性的形式编写。例如上面 AddService 中的 A、B 两个属性是输出属性，而 Result 属性则是输出属性。</p><ul><li><p>输出属性</p><p>
                            标记了 <span class="code">ServiceOutputAttribute</span> 特性的属性都是服务的输出。
                        </p><p>注意，一个服务可以有多个输出。</p></li><li><p>输入属性</p><p>
                            没有任何标记、或者标记了 <span class="code">ServiceInputAttribute</span> 特性的属性都是服务的输入。
                        </p><p>一个属性可以即是输入也是输出，这时需要同时标记以上两个特性。</p></li></ul></div><div class="collapsibleAreaRegion" id="ext"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID4RB')" onkeypress="SectionExpandCollapse_CheckKey('ID4RB', event)" tabindex="0"><img id="ID4RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />服务的扩展</span></div><div id="ID4RBSection" class="collapsibleSection"><p>在低启动级别的插件中，可以使用 ServiceFactory.Override 方法来替换高启动级别插件中的指定服务。这样，使用工厂创建出的服务，都是替换后的服务。</p></div><div class="collapsibleAreaRegion" id="soa"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID5RB')" onkeypress="SectionExpandCollapse_CheckKey('ID5RB', event)" tabindex="0"><img id="ID5RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />SOA</span></div><div id="ID5RBSection" class="collapsibleSection"><p>由于使用了单独的类来封装每一个服务，可使用反射更方便地遍历出所有的服务，所以更便于对服务进行管理。框架提供了 API 来完成查询服务、替换服务等功能。</p></div></div></div><div id="pageFooter" class="pageFooter">有问题请联系 9474649@qq.com。<div class="feedbackLink">有关这个主题的评论请发邮件到
        <a id="HT_MailLink" href="mailto:9474649%40qq.com?Subject=Rafy User Guide">发送反馈</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>